#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Maven Wrapper startup batch script, version 3.2.0
#
# Optional ENV vars
# -----------------
#   JAVA_HOME - location of a JDK home dir, secondary to JAVA_EXE
# ----------------------------------------------------------------------------

set -e

# OS specific support. $var _must_ be set to either true or false.
cygwin=false;
darwin=false;
case "`uname`" in
  CYGWIN*) cygwin=true ;;
  Darwin*) darwin=true ;;
esac

# -----------------------------------------------------------------------------
# Function to download a file from a URL
# -----------------------------------------------------------------------------
download() {
  url=$1
  target=$2
  if command -v curl >/dev/null 2>&1; then
    curl -sSL "$url" -o "$target"
  elif command -v wget >/dev/null 2>&1; then
    wget -qO "$target" "$url"
  else
    echo "Error: curl or wget not found" >&2
    exit 1
  fi
}

# -----------------------------------------------------------------------------
# Main setup for mvnw
# -----------------------------------------------------------------------------

# determine the location of the wrapper script
basedir="`dirname "$0"`"
prjdir="`cd "$basedir" && pwd`"

# find the wrapper jar
wrapper_jar="$prjdir/.mvn/wrapper/maven-wrapper.jar"
properties_file="$prjdir/.mvn/wrapper/maven-wrapper.properties"

if [ ! -f "$wrapper_jar" ]; then
    echo "Downloading Maven Wrapper..."
    # extract distribution url from properties
    dist_url=`grep 'wrapperUrl' "$properties_file" | cut -d'=' -f2 | tr -d '\r'`
    download "$dist_url" "$wrapper_jar"
fi

# find the project root (where .mvn is)
MAVEN_PROJECTBASEDIR="$prjdir"
while [ "$MAVEN_PROJECTBASEDIR" != "/" ] && [ ! -d "$MAVEN_PROJECTBASEDIR/.mvn" ]; do
  MAVEN_PROJECTBASEDIR=`cd "$MAVEN_PROJECTBASEDIR/.." && pwd`
done

# execute the wrapper jar
exec java \
  -Dmaven.multiModuleProjectDirectory="$MAVEN_PROJECTBASEDIR" \
  -cp "$wrapper_jar" \
  org.apache.maven.wrapper.MavenWrapperMain "$@"
